â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                 POST-VISION SELECTOR SYNTHESIS ARCHITECTURE                    â•‘
â•‘                                                                                â•‘
â•‘  Automatic selector learning system to skip expensive GPU vision calls        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ELEMENT LOOKUP REQUEST                                                     â”‚
â”‚  Input: page, description ("the blue Submit button")                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   VISUAL GROUNDING ENGINE                          â”‚
        â”‚   (visual_grounding.py)                            â”‚
        â”‚                                                    â”‚
        â”‚   Strategy: HYBRID (default)                       â”‚
        â”‚   - Site Memory â†’ DOM â†’ Vision                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: CHECK SITE MEMORY                                                  â”‚
â”‚  _try_site_memory_selector()                                                â”‚
â”‚                                                                             â”‚
â”‚  Query: URL pattern + description                                           â”‚
â”‚  Example: "example.com/login" + "the username input field"                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚  SITE MEMORY DATABASE                   â”‚                               â”‚
â”‚  â”‚  (memory/site_memory.db)                â”‚                               â”‚
â”‚  â”‚                                         â”‚                               â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                               â”‚
â”‚  â”‚  â”‚ Memory Entry                       â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - memory_id: abc123                â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - url_pattern: example.com/login   â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - description: "username field"    â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - selectors: [                     â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚     {type: "css",                  â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚      selector: "#username",        â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚      priority: 100},               â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚     {type: "css",                  â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚      selector: "input[name=user]", â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚      priority: 80}                 â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚   ]                                â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - confidence: 0.95                 â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - success_count: 127               â”‚ â”‚                               â”‚
â”‚  â”‚  â”‚ - failure_count: 2                 â”‚ â”‚                               â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚  Found   â”‚           â”‚ Not Foundâ”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                     â”‚
                         â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  TRY SELECTORS IN ORDER    â”‚  â”‚  STEP 2: TRY DOM             â”‚
        â”‚                            â”‚  â”‚  _ground_with_dom()           â”‚
        â”‚  for selector in selectors:â”‚  â”‚                               â”‚
        â”‚    try:                    â”‚  â”‚  Use DOM distillation to find â”‚
        â”‚      element = find(sel)   â”‚  â”‚  element by semantic matching â”‚
        â”‚      if element:           â”‚  â”‚                               â”‚
        â”‚        return SUCCESS âœ“    â”‚  â”‚  Confidence > 0.7?            â”‚
        â”‚    except:                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚      continue               â”‚                â”‚
        â”‚                            â”‚                â”‚
        â”‚  All failed? Fallback â”€â”€â”  â”‚           â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  Success â”‚
                 â”‚                  â”‚           â”‚    OR    â”‚
                 â”‚                  â”‚           â”‚  Failure â”‚
                 â”‚                  â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â–¼                  â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                â–¼
        â”‚   SUCCESS!     â”‚          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚          â”‚     â”‚ STEP 3: USE VISION MODEL     â”‚
        â”‚ - Update stats â”‚          â””â”€â”€â”€â”€>â”‚ _ground_with_vision()        â”‚
        â”‚ - Mark success â”‚                â”‚                              â”‚
        â”‚ - Return elem  â”‚                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚                â”‚                â”‚ â”‚  MOONDREAM / OLLAMA      â”‚ â”‚
        â”‚ Time: ~30ms    â”‚                â”‚ â”‚  Vision Model (GPU)      â”‚ â”‚
        â”‚ GPU: None âœ“    â”‚                â”‚ â”‚                          â”‚ â”‚
        â”‚                â”‚                â”‚ â”‚  Input:                  â”‚ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ â”‚  - Screenshot            â”‚ â”‚
                                          â”‚ â”‚  - Description           â”‚ â”‚
                                          â”‚ â”‚                          â”‚ â”‚
                                          â”‚ â”‚  Output:                 â”‚ â”‚
                                          â”‚ â”‚  - Element coordinates   â”‚ â”‚
                                          â”‚ â”‚  - Confidence score      â”‚ â”‚
                                          â”‚ â”‚                          â”‚ â”‚
                                          â”‚ â”‚  Time: ~3 seconds        â”‚ â”‚
                                          â”‚ â”‚  Cost: GPU cycles        â”‚ â”‚
                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
                                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: POST-VISION SELECTOR SYNTHESIS                                     â”‚
â”‚  _synthesize_and_save_selectors()                                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  SELECTOR SYNTHESIZER                          â”‚                        â”‚
â”‚  â”‚  (SelectorSynthesizer)                         â”‚                        â”‚
â”‚  â”‚                                                â”‚                        â”‚
â”‚  â”‚  1. Get element at coordinates                 â”‚                        â”‚
â”‚  â”‚     element = elementFromPoint(x, y)           â”‚                        â”‚
â”‚  â”‚                                                â”‚                        â”‚
â”‚  â”‚  2. Extract attributes                         â”‚                        â”‚
â”‚  â”‚     attrs = {                                  â”‚                        â”‚
â”‚  â”‚       id: "username",                          â”‚                        â”‚
â”‚  â”‚       name: "user",                            â”‚                        â”‚
â”‚  â”‚       class: "input-field form-control",       â”‚                        â”‚
â”‚  â”‚       type: "text",                            â”‚                        â”‚
â”‚  â”‚       aria-label: "Username",                  â”‚                        â”‚
â”‚  â”‚       placeholder: "Enter username"            â”‚                        â”‚
â”‚  â”‚     }                                          â”‚                        â”‚
â”‚  â”‚                                                â”‚                        â”‚
â”‚  â”‚  3. Generate selector candidates               â”‚                        â”‚
â”‚  â”‚     Strategy        Priority  Selector         â”‚                        â”‚
â”‚  â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                        â”‚
â”‚  â”‚     ID               100      #username        â”‚                        â”‚
â”‚  â”‚     ARIA label        90      [aria-label=...] â”‚                        â”‚
â”‚  â”‚     Name              80      input[name=user] â”‚                        â”‚
â”‚  â”‚     Unique class      70      .input-field     â”‚                        â”‚
â”‚  â”‚     Type+Placeholder  60      input[type=...] â”‚                        â”‚
â”‚  â”‚     Stable XPath      50      //input[@name...â”‚                        â”‚
â”‚  â”‚                                                â”‚                        â”‚
â”‚  â”‚  4. Validate each selector                     â”‚                        â”‚
â”‚  â”‚     for candidate in candidates:               â”‚                        â”‚
â”‚  â”‚       element = page.query_selector(candidate) â”‚                        â”‚
â”‚  â”‚       bbox = element.bounding_box()            â”‚                        â”‚
â”‚  â”‚       center = calculate_center(bbox)          â”‚                        â”‚
â”‚  â”‚       if distance(center, target) < 50px:      â”‚                        â”‚
â”‚  â”‚         mark_as_validated(candidate)           â”‚                        â”‚
â”‚  â”‚                                                â”‚                        â”‚
â”‚  â”‚  5. Return validated selectors (sorted by pri) â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                             â”‚
â”‚  Result: [                                                                  â”‚
â”‚    {type: "css", selector: "#username", priority: 100, validated: true},   â”‚
â”‚    {type: "css", selector: "[aria-label='Username']", priority: 90, ...},  â”‚
â”‚    {type: "css", selector: "input[name='user']", priority: 80, ...}        â”‚
â”‚  ]                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAVE TO SITE MEMORY                                                        â”‚
â”‚                                                                             â”‚
â”‚  Create SiteMemory entry:                                                   â”‚
â”‚  - memory_id: hash(url + description)                                       â”‚
â”‚  - url_pattern: "example.com/login"                                         â”‚
â”‚  - element_description: "the username input field"                          â”‚
â”‚  - selectors: [validated selectors]                                         â”‚
â”‚  - element_type: "input"                                                    â”‚
â”‚  - element_text: ""                                                         â”‚
â”‚  - element_attributes: {id: "username", ...}                                â”‚
â”‚  - bbox: {x: 100, y: 200, width: 300, height: 40}                          â”‚
â”‚  - center: (250, 220)                                                       â”‚
â”‚  - confidence: 0.95                                                         â”‚
â”‚  - created_at: "2025-12-07T19:30:00"                                        â”‚
â”‚  - use_count: 1                                                             â”‚
â”‚  - success_count: 1                                                         â”‚
â”‚                                                                             â”‚
â”‚  Store in database (async):                                                 â”‚
â”‚    INSERT INTO site_memory VALUES (...)                                     â”‚
â”‚                                                                             â”‚
â”‚  Logger: "Saved 3 selectors to site memory (best: #username)"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FUTURE LOOKUP (SAME ELEMENT)                                               â”‚
â”‚                                                                             â”‚
â”‚  Request: page, "the username input field"                                  â”‚
â”‚                                                                             â”‚
â”‚  Step 1: Check site memory                                                  â”‚
â”‚    âœ“ Found entry!                                                           â”‚
â”‚    âœ“ 3 selectors available                                                  â”‚
â”‚    âœ“ Confidence: 0.95                                                       â”‚
â”‚                                                                             â”‚
â”‚  Step 2: Try first selector (#username)                                     â”‚
â”‚    âœ“ Element found!                                                         â”‚
â”‚    âœ“ Coordinates match                                                      â”‚
â”‚    âœ“ Return success                                                         â”‚
â”‚                                                                             â”‚
â”‚  Result:                                                                    â”‚
â”‚    - SUCCESS in ~30ms (vs 3000ms with vision)                              â”‚
â”‚    - GPU cycles saved: 100%                                                 â”‚
â”‚    - Cost saved: ~$0.01                                                     â”‚
â”‚    - Speedup: 100x                                                          â”‚
â”‚                                                                             â”‚
â”‚  Update memory:                                                             â”‚
â”‚    - use_count: 2                                                           â”‚
â”‚    - success_count: 2                                                       â”‚
â”‚    - confidence: min(1.0, 0.95 + 0.05) = 1.0                               â”‚
â”‚    - last_used: "2025-12-07T19:35:00"                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIDENCE MANAGEMENT                                                      â”‚
â”‚                                                                             â”‚
â”‚  Initial confidence: 1.0 (after validation)                                 â”‚
â”‚                                                                             â”‚
â”‚  On success:                                                                â”‚
â”‚    confidence = min(1.0, confidence + 0.05)                                 â”‚
â”‚    Example: 0.95 â†’ 1.0                                                      â”‚
â”‚                                                                             â”‚
â”‚  On failure:                                                                â”‚
â”‚    confidence = max(0.0, confidence - 0.10)                                 â”‚
â”‚    Example: 1.0 â†’ 0.9 â†’ 0.8 â†’ 0.7 â†’ 0.6 â†’ 0.5 â†’ 0.4                       â”‚
â”‚                                                                             â”‚
â”‚  Below threshold (0.5):                                                     â”‚
â”‚    - Selector not used                                                      â”‚
â”‚    - Fallback to vision                                                     â”‚
â”‚    - Re-synthesis and re-validation                                         â”‚
â”‚    - New selectors saved (site structure may have changed)                 â”‚
â”‚                                                                             â”‚
â”‚  Self-healing: Automatically detects and adapts to site changes             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STATISTICS TRACKING                                                        â”‚
â”‚                                                                             â”‚
â”‚  VisualGroundingEngine stats:                                              â”‚
â”‚    {                                                                        â”‚
â”‚      "total_groundings": 100,                                               â”‚
â”‚      "vision_successes": 10,          # Vision model calls                 â”‚
â”‚      "vision_calls_skipped": 90,      # Saved by site memory               â”‚
â”‚      "site_memory_hits": 90,          # Selector worked                    â”‚
â”‚      "site_memory_misses": 10,        # No saved selector                  â”‚
â”‚      "selectors_synthesized": 10,     # New selectors created              â”‚
â”‚      "dom_successes": 5,              # DOM found element                  â”‚
â”‚      "avg_confidence": 0.92           # Average confidence                 â”‚
â”‚    }                                                                        â”‚
â”‚                                                                             â”‚
â”‚  Savings calculation:                                                       â”‚
â”‚    GPU savings: 90/100 = 90%                                                â”‚
â”‚    Time saved: 90 * 3s = 270s (4.5 minutes)                                â”‚
â”‚    Cost saved: 90 * $0.01 = $0.90                                          â”‚
â”‚                                                                             â”‚
â”‚  SiteMemoryStore stats:                                                     â”‚
â”‚    {                                                                        â”‚
â”‚      "memories_stored": 10,           # Unique elements learned            â”‚
â”‚      "memories_retrieved": 90,        # Lookups from memory                â”‚
â”‚      "cache_hits": 90,                # Selectors worked                   â”‚
â”‚      "cache_misses": 10               # No memory or selector failed       â”‚
â”‚    }                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  KEY BENEFITS                                                              â•‘
â•‘                                                                            â•‘
â•‘  âš¡ Performance:     100x faster (3000ms â†’ 30ms)                           â•‘
â•‘  ğŸ’° Cost Savings:    99% reduction after first visit                       â•‘
â•‘  ğŸ¯ Accuracy:        Same as vision (validated selectors)                  â•‘
â•‘  ğŸ”„ Self-healing:    Confidence decay triggers re-learning                 â•‘
â•‘  ğŸš€ Zero config:     Automatic integration, no code changes                â•‘
â•‘  ğŸ›¡ï¸  Production-ready: Async, persistent, concurrent-safe                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  INTEGRATION WITH EXISTING SYSTEMS                                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VISUAL GROUNDING (visual_grounding.py)                                     â”‚
â”‚                                                                             â”‚
â”‚  Enhanced with:                                                             â”‚
â”‚  - Pre-vision site memory check                                             â”‚
â”‚  - Post-vision selector synthesis                                           â”‚
â”‚  - Statistics tracking                                                      â”‚
â”‚  - Confidence management                                                    â”‚
â”‚                                                                             â”‚
â”‚  Strategies:                                                                â”‚
â”‚  - HYBRID (default): Site Memory â†’ DOM â†’ Vision                            â”‚
â”‚  - VISION_ONLY: Vision + synthesis                                          â”‚
â”‚  - DOM_ONLY: DOM only (no synthesis)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEMORY ARCHITECTURE (memory_architecture.py)                               â”‚
â”‚                                                                             â”‚
â”‚  Site Memory follows same patterns:                                         â”‚
â”‚  - Async database operations (aiosqlite)                                    â”‚
â”‚  - Read/write locks for concurrency                                         â”‚
â”‚  - Sync fallbacks for compatibility                                         â”‚
â”‚  - SQLite storage in memory/ directory                                      â”‚
â”‚                                                                             â”‚
â”‚  Memory types:                                                              â”‚
â”‚  - Working Memory (recent steps)                                            â”‚
â”‚  - Episodic Memory (task experiences)                                       â”‚
â”‚  - Semantic Memory (generalized knowledge)                                  â”‚
â”‚  - Skill Memory (action sequences)                                          â”‚
â”‚  - Site Memory (selectors) â† NEW                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FILES STRUCTURE                                                            â”‚
â”‚                                                                             â”‚
â”‚  agent/                                                                     â”‚
â”‚  â”œâ”€â”€ visual_grounding.py                  (enhanced with site memory)      â”‚
â”‚  â”œâ”€â”€ site_memory.py                       (NEW - selector storage)         â”‚
â”‚  â”œâ”€â”€ memory_architecture.py               (existing - memory base)         â”‚
â”‚  â”œâ”€â”€ post_vision_selector_synthesis_example.py  (NEW - demos)              â”‚
â”‚  â”œâ”€â”€ POST_VISION_SELECTOR_SYNTHESIS_README.md   (NEW - docs)               â”‚
â”‚  â”œâ”€â”€ POST_VISION_SELECTOR_SYNTHESIS_QUICK_REF.md (NEW - quick ref)         â”‚
â”‚  â””â”€â”€ memory/                                                                â”‚
â”‚      â”œâ”€â”€ episodic_memory.db                                                 â”‚
â”‚      â”œâ”€â”€ semantic_memory.db                                                 â”‚
â”‚      â”œâ”€â”€ skill_memory.db                                                    â”‚
â”‚      â””â”€â”€ site_memory.db                   (NEW - selector database)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
